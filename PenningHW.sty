\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{PenningNotes}

\RequirePackage{amsfonts}
\RequirePackage{amsthm}
\RequirePackage{amsmath}
\RequirePackage[dvipsnames]{xcolor}
\RequirePackage[breakable, skins]{tcolorbox}
\RequirePackage{physics}
\RequirePackage{amssymb}

%\newcommand{\abs}[1]{\left|#1\right|}
%\newcommand{\norm}[1]{\lVert#1\rVert}

% Make ref footnote based on:
% https://tex.stackexchange.com/questions/30720/footnote-without-a-marker

\usepackage{lipsum}
\colorlet{colexam}{red!75!black}


%Define commands for the user to pass
\colorlet{UNFINISHED}            {Fuchsia}
\colorlet{FINISHED}              {blue}
\colorlet{OPTIONAL}              {Cyan}
\colorlet{OPTIONALFINISHED}      {blue}
\colorlet{CHECKED}               {ForestGreen}


% by default, make the handwritten command blank
\newcommand{\handwrittencmd}{}
\newcommand{\handwritteninlinecmd}{}
\newcommand{\handwrittenlowervisible}{visible}



\newcommand{\defaultoverlayunbroken}[1]{ %add if unbroken
	\draw
		[#1,line width=1pt]
		(frame.north east)
		--
		(frame.south east)
		--
		(frame.south west); 
}
\newcommand{\defaultoverlayfirst}[1]{
	\draw
		[#1,line width=1pt]
		(frame.north east)
		--
		(frame.south east); 
}
\newcommand{\defaultoverlaymiddle}[1]{ %to be added to middle parts of broken sequence
	\draw
		[#1,line width=1pt]
		(frame.north east)
		--
		(frame.south east); 
}
\newcommand{\defaultoverlaylast}[1]{ %add to last part of broken sequence
	\draw
		[#1,line width=1pt]
		(frame.north east)
		--
		(frame.south east)
		--
		(frame.south west);
}
% \defaultoverlayunbroken
% \defaultoverlayfirst
% \defaultoverlaymiddle
% \defaultoverlaylast

%run the following commands if the user passes "handwritten"
\DeclareOption{handwritten}
{ 
	%Add a new page after each "main problem"
	\renewcommand{\handwrittencmd}{\newpage\relax}
	% add space after each inline part
	\renewcommand{\handwritteninlinecmd}{\vspace{4in}}
	% Do not write any current work
	\renewcommand{\handwrittenlowervisible}{ignored}

	% Change all problem colors to blue (keep optional problems labeled.)
	\colorlet{UNFINISHED}            {blue}
	\colorlet{FINISHED}              {blue}
	\colorlet{OPTIONAL}              {Cyan}
	\colorlet{OPTIONALFINISHED}      {blue}
	\colorlet{CHECKED}               {blue}

	
	%do not draw border in handwritten mode
	\renewcommand{\defaultoverlayunbroken}[1]{}
	\renewcommand{\defaultoverlayfirst}[1]{}
	\renewcommand{\defaultoverlaymiddle}[1]{}
	\renewcommand{\defaultoverlaylast}[1]{}
}

\ProcessOptions\relax



\newtcolorbox[]{newProblemBLANK}[2]{% 1 = color; 2 = title
	empty,
	lowerbox = \handwrittenlowervisible, % hide if in handwritten mode
	title= #2,
	%detach title,
	attach boxed title to top left,
	boxed title style={ %draw title style
		empty,
		size=minimal,
		toprule=2pt,
		top=4pt,
		bottom=4pt,
	},
	coltitle=#1,
	colupper=#1,
	fonttitle=\Large\bfseries,
	parbox=false,
	boxsep=0pt,
	left=0pt,
	right=3mm,
	top=4pt,
	breakable,
	pad at break*=0mm,
	vfill before first,
	%
	% draw box border
	overlay unbroken=\defaultoverlayunbroken{#1},
	overlay first=\defaultoverlayfirst{#1},
	overlay middle=\defaultoverlaymiddle{#1},
	overlay last=\defaultoverlaylast{#1},
	%	
	nobeforeafter, % clear "after " command
	before=\par\medskip\noindent,
	after = {\handwrittencmd} %run handwritten command defined earlier
}


\newtcolorbox[]{newInlineProblemBLANK}[2]{% 1 = color; 2 = title
	empty,
	title= #2,
	lowerbox = \handwrittenlowervisible, % hide if in handwritten mode
	attach title to upper,
	after title =\ \ ,
	coltitle=#1,
	colupper=#1,
	fonttitle=\normalsize\bfseries,
	parbox=false,
	boxsep=0pt,
	left=0pt,
	right=3mm,
	top=4pt,
	breakable,
	pad at break*=0mm,
	vfill before first,
	%
	% draw box border
	overlay unbroken=\defaultoverlayunbroken{#1},
	overlay first=\defaultoverlayfirst{#1},
	overlay middle=\defaultoverlaymiddle{#1},
	overlay last=\defaultoverlaylast{#1},
	%
	nobeforeafter, % clear "after" command
	before=\par\medskip\noindent,
	after = {\handwritteninlinecmd} %run handwritten command defined earlier
}






\newenvironment{newProblem}[2][FINISHED]
{ \begin{newProblemBLANK}{#1}{#2}}
{ \end{newProblemBLANK} }

\newenvironment{newInlineProblem}[2][FINISHED]
{ \begin{newInlineProblemBLANK}{#1}{#2}}
{ \end{newInlineProblemBLANK} }
